<%@ page import="org.jivesoftware.messenger.Session,
                 org.xmpp.packet.Presence,
                 java.net.URLEncoder,
                 org.jivesoftware.util.LocaleUtils,
                 org.jivesoftware.util.JiveGlobals,
                 java.util.Date"%>
 <%--
  -	$RCSfile$
  -	$Revision$
  -	$Date$
--%>

<%--
  - This page is meant to be included in other pages. It assumes 4 variables:
  -     * 'host', the name of the remote server
  -     * 'inSession', an  IncomingServerSession object
  -     * 'outSession', an OutgoingServerSession object
  -     * 'count', an int representing the row number we're on.
--%>

<tr class="jive-<%= (((count % 2) == 0) ? "even" : "odd") %>">
    <td width="1%" nowrap><%= count %></td>
    <td width="47%" nowrap>
        <a href="server-session-details.jsp?hostname=<%= URLEncoder.encode(host, "UTF-8") %>" title="<fmt:message key="session.row.cliked" />"><%= host %></a>
    </td>
    <% if (inSession != null && outSession == null) { %>
        <td width="1%">
            <img src="images/incoming_32x16.gif" width="32" height="16" border="0" title="<fmt:message key="server.session.connection.incoming" />">
        </td>
        <td width="10%"><fmt:message key="server.session.connection.incoming" /></td>
    <% } else if (inSession == null && outSession != null) { %>
        <td width="1%">
            <img src="images/outgoing_32x16.gif" width="32" height="16" border="0" title="<fmt:message key="server.session.connection.outgoing" />">
        </td>
        <td width="10%"><fmt:message key="server.session.connection.outgoing" /></td>
    <% } else { %>
        <td width="1%">
            <img src="images/both_32x16.gif" width="32" height="16" border="0" title="<fmt:message key="server.session.connection.both" />">
        </td>
        <td width="10%"><fmt:message key="server.session.connection.both" /></td>
    <% } %>

    <% Date creationDate = null;
        Date lastActiveDate = null;
        if (inSession != null && outSession == null) {
            creationDate = inSession.getCreationDate();
            lastActiveDate = inSession.getLastActiveDate();
        }
        else if (inSession == null && outSession != null) {
            creationDate = outSession.getCreationDate();
            lastActiveDate = outSession.getLastActiveDate();
        }
        else {
            creationDate = inSession.getCreationDate().before(outSession.getCreationDate()) ? inSession.getCreationDate() : outSession.getCreationDate();
            lastActiveDate = inSession.getLastActiveDate().after(outSession.getLastActiveDate()) ? inSession.getLastActiveDate() : outSession.getLastActiveDate();
        }
        long now = System.currentTimeMillis();
    %>

    <td align="center" width="20%" nowrap>
        <%= (now - creationDate.getTime() < 24*60*60*1000) ? JiveGlobals.formatTime(creationDate) : JiveGlobals.formatDateTime(creationDate) %>
    </td>
    <td align="center" width="20%" nowrap>
        <%= (now - lastActiveDate.getTime() < 24*60*60*1000) ? JiveGlobals.formatTime(lastActiveDate) : JiveGlobals.formatDateTime(lastActiveDate) %>
    </td>

    <td width="1%" nowrap align="center" style="border-right:1px #ccc solid;">
        <a href="server-session-summary.jsp?hostname=<%= URLEncoder.encode(host, "UTF-8") %>&close=true"
         title="<fmt:message key="session.row.cliked_kill_session" />"
         onclick="return confirm('<fmt:message key="session.row.confirm_close" />');"
         ><img src="images/delete-16x16.gif" width="16" height="16" border="0"></a>
    </td>
</tr>